<html>
<head> 
<title>AOp</title>
</head>
<body>
<p>
<a href="https://github.com/laforge49/JActor2#readme">JActor2</a> &gt; <a href="../../index.html">Docs</a> &gt; <a href="../index.html">Tutorials</a> &gt; <a href="index.html">Core</a> &gt; ForeignPing
</p>
<h1>ForeignPing - AOp</h1>
<p>
A SOp must operate within the confines of a single reactor/thread.
In contrast, an
<a href="../../api/core/org/agilewiki/jactor2/core/requests/AOp.html">AOp</a>
can interact with blades which do not have the same reactor via a
<a href="../../api/core/org/agilewiki/jactor2/core/requests/impl/AsyncRequestImpl.html#send-org.agilewiki.jactor2.core.requests.AOp-org.agilewiki.jactor2.core.requests.AsyncResponseProcessor-">send</a>
method.
This is illustrated by the <a href="java7/ForeignPing.java">ForeignPing</a> program:
</p>
<pre>
import org.agilewiki.jactor2.core.blades.NonBlockingBladeBase;
import org.agilewiki.jactor2.core.impl.Plant;
import org.agilewiki.jactor2.core.requests.AOp;
import org.agilewiki.jactor2.core.requests.AsyncResponseProcessor;
import org.agilewiki.jactor2.core.requests.SOp;
import org.agilewiki.jactor2.core.requests.impl.AsyncRequestImpl;

public class ForeignPing extends NonBlockingBladeBase {
    private final Ponger ponger;

    public ForeignPing(final Ponger _ponger) throws Exception {
        ponger = _ponger;
    }
    
    public AOp&lt;Void&gt; pingAOp() {
        return new AOp&lt;Void&gt;("ping", getReactor()) {
            @Override
            protected void processAsyncOperation(final AsyncRequestImpl _asyncRequestImpl, 
					final AsyncResponseProcessor&lt;Void&gt; _asyncResponseProcessor) throws Exception {
				AsyncResponseProcessor&lt;Long&gt; pongerResponseProcessor = 
						new AsyncResponseProcessor&lt;Long&gt;() {
					public void processAsyncResponse(final Long response) throws Exception {
						_asyncResponseProcessor.processAsyncResponse(null);
					}
				};
            
                SOp&lt;Long&gt; pingSOp = ponger.pingSOp();
                _asyncRequestImpl.send(pingSOp, pongerResponseProcessor);
            }
        };
    }
    
    public static void main(String[] args) throws Exception {
        new Plant();
        try {
            Ponger ponger = new Ponger();
            ForeignPing foreignPing = new ForeignPing(ponger);
            AOp&lt;Void&gt; pingAOp = foreignPing.pingAOp();
            pingAOp.call();
        } finally {
            Plant.close();
        }
    }
}
</pre>
<table style="border: 2px solid;" bgcolor="lightgray">
<tr>
<th style="padding: 5px;" bgcolor="lightyellow">
Main Thread
</th>
<th>&nbsp;

</th>
<th style="padding: 5px;" bgcolor="lightyellow">
Non-blocking Reactor
</th>
<th>&nbsp;

</th>
<th style="padding: 5px;" bgcolor="lightyellow">
Non-blockingReactor
</th>
</tr>
<tr>
<th style="padding: 5px;" bgcolor="lightyellow">
ForeignPing
</th>
<th>&nbsp;

</th>
<th style="padding: 5px;" bgcolor="lightyellow">
ForeignPing
</th>
<th>&nbsp;

</th>
<th style="padding: 5px;" bgcolor="lightyellow">
Ponger
</th>
</tr>
<tr>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
call
</td>
<td>&nbsp;

</td>
<td>&nbsp;

</td>
<td>&nbsp;

</td>
<td>&nbsp;

</td>
</tr>
<tr>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
wait
</td>
<td style="padding: 5px; text-align: center;">
---pingAReq-->
</td>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
allocate thread
</td>
<td>&nbsp;

</td>
<td>&nbsp;

</td>
</tr>
<tr>
<td>&nbsp;

</td>
<td>&nbsp;

</td>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
send
</td>
<td>&nbsp;

</td>
<td>&nbsp;

</td>
</tr>
<tr>
<td>&nbsp;

</td>
<td>&nbsp;

</td>
<td>&nbsp;

</td>
<td style="padding: 5px; text-align: center;">
---(thread, pingSReq)-->
</td>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
ping
</td>
</tr>
<tr>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
wakeup
</td>
<td style="padding: 5px; text-align: center;">
<--response: null--
</td>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
release thread
</td>
<td style="padding: 5px; text-align: center;">
<--(thread, response: 1)---
</td>
<td>&nbsp;

</td>
</tr>
<tr>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
close
</td>
<td>&nbsp;

</td>
<td>&nbsp;

</td>
<td>&nbsp;

</td>
<td>&nbsp;

</td>
</tr>
</table>
<h2>
Multiple Reactors
</h2>
<pre>
public class ForeignPing extends NonBlockingBladeBase {
    private final Ponger ponger;

    public ForeignPing(final Ponger _ponger) {
        ponger = _ponger;
    }
    
    ...
}
</pre>
<p>
The default constructor of NonBlockingBladeBase, used by both Ponger and ForeignPing, 
creates a NonBlockingReactor for those blades.
</p>
<h2>
AOp
</h2>
<pre>
    public AOp&lt;Void&gt; pingAOp() {
        return new AOp&lt;Void&gt;("ping", getReactor()) {
            ...
        };
    }
</pre>
<p>
Because Ponger and ForeignPing have different reactors,
it is not safe for an operation in ForeignPing to directly call a method in Ponger.
This is why an operation in ForeignPing must use the send method in AsyncRequestImpl.
</p>
<h2>
<a href="../../api/core/org/agilewiki/jactor2/core/requests/AsyncResponseProcessor.html">AsyncResponseProcessor</a>
</h2>
<p>
The AsyncRequest interface extends AsyncResponseProcessor, which provides the
<a href="../../api/core/org/agilewiki/jactor2/core/requests/AsyncResponseProcessor.html#processAsyncResponse-RESPONSE_TYPE-">processAsyncResponse</a>
method.
This method is used to pass back the result of the AsyncRequest to the code that invoked it.
</p>
<pre>
				AsyncResponseProcessor&lt;Long&gt; pongerResponseProcessor = 
						new AsyncResponseProcessor&lt;Long&gt;() {
					public void processAsyncResponse(final Long response) throws Exception {
						_asyncResponseProcessor.processAsyncResponse(null);
					}
				};
</pre>
<p>
The AsyncResponseProcessor, pongerResponseProcessor, is used to process the Long response
from Ponger's pingSReq.
</p>
<h2>
<a href="../../api/core/org/agilewiki/jactor2/core/requests/AsyncOperation.html#processAsyncOperation-org.agilewiki.jactor2.core.requests.impl.AsyncRequestImpl-org.agilewiki.jactor2.core.requests.AsyncResponseProcessor-">processAsyncOperation</a>
</h2>
<pre>
            protected void processAsyncOperation(final AsyncRequestImpl _asyncRequestImpl, 
					final AsyncResponseProcessor&lt;Void&gt; _asyncResponseProcessor) throws Exception {
				...
            
                SOp&lt;Long&gt; pingSOp = ponger.pingSOp();
                _asyncRequestImpl.send(pingSOp, pongerResponseProcessor);
            }
</pre>
<p>
The processAsyncOperation method is called when pingAOp is invoked.
But it is invoked on the ForeignPing's thread instead of the thread of the code that invoked pingAOp, 
which is why it is thread-safe.
</p>
<h3>
main
</h3>
<pre>
    public static void main(String[] args) throws Exception {
        new Plant();
        try {
            Ponger ponger = new Ponger();
            ForeignPing foreignPing = new ForeignPing(ponger);
            AOp&lt;Void&gt; pingAOp = foreignPing.pingAOp();
            pingAOp.call();
        } finally {
            Plant.close();
        }
    }
</pre>
<p>
The call method is defined for both SOp and AOp.
It blocks the thread until a response is returned and <strong>can not be used when processing a request</strong>.
</p>
</body>
</html>
