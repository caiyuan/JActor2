<html>
<title>Lightweight Threads</title>
</head>
<body>
<p>
<a href="https://github.com/laforge49/JActor2#readme">JActor2</a> &gt; <a href="../../index.html">Docs</a> &gt; <a href="../index.html">Tutorials</a> &gt; <a href="index.html">Core</a> &gt; Reactors
</p>
<h1>Reactors - Lightweight Threads</h1>
<p>
Reactors manage message flow and serve as lightweight threads.
(A message is created when an operation is called, sent or signaled.)
A reactor is assigned a thread when it has work to do. 
The reactor releases the thread
either when there is nothing left to work on or 
when the thread follows a message and migrates to another reactor.
Several different types of reactors are provided:
</p>
<table style="border: 2px solid;" bgcolor="lightgray">
<tr>
<th style="padding: 5px;" bgcolor="lightyellow">
Reactor Class
</th>
<th style="padding: 5px;" bgcolor="lightyellow">
Implements<br>
<a href="../../api/core/org/agilewiki/jactor2/core/reactors/CommonReactor.html">CommonReactor</a>
</th>
<th style="padding: 5px;" bgcolor="lightyellow">
Usage
</th>
<th style="padding: 5px;" bgcolor="lightyellow">
Buffered Messages
</th>
</tr>

<tr>
<td style="padding: 5px;" bgcolor="lightyellow">
<a href="../../api/core/org/agilewiki/jactor2/core/reactors/NonBlockingReactor.html">NonBlockingReactor</a>
</td>
<td style="padding: 5px;" bgcolor="lightyellow">
True
</td>
<td style="padding: 5px;" bgcolor="lightyellow">
Messages are processed quickly.
</td>
<td style="padding: 5px;" bgcolor="lightyellow">
Disbursed when there are no more messages to be processed.
</td>
</tr>

<tr>
<td style="padding: 5px;" bgcolor="lightyellow">
<a href="../../api/core/org/agilewiki/jactor2/core/reactors/BlockingReactor.html">BlockingReactor</a>
</td>
<td style="padding: 5px;" bgcolor="lightyellow">
True
</td>
<td style="padding: 5px;" bgcolor="lightyellow">
Messages may block the thread or perform long computations.
</td>
<td style="padding: 5px;" bgcolor="lightyellow">
Disbursed after processing each message.
</td>
</tr>

<tr>
<td style="padding: 5px;" bgcolor="lightyellow">
<a href="../../api/core/org/agilewiki/jactor2/core/reactors/IsolationReactor.html">IsolationReactor</a>
</td>
<td style="padding: 5px;" bgcolor="lightyellow">
False
</td>
<td style="padding: 5px;" bgcolor="lightyellow">
Operations are processed to completion before the next request is processed.
However the processing of signals is not constrained.
</td>
<td style="padding: 5px;" bgcolor="lightyellow">
Disbursed after processing each message.
</td>
</tr>

<tr>
<td style="padding: 5px;" bgcolor="lightyellow">
<a href="../../api/core/org/agilewiki/jactor2/core/reactors/ThreadBoundReactor.html">ThreadBoundReactor</a>
</td>
<td style="padding: 5px;" bgcolor="lightyellow">
True
</td>
<td style="padding: 5px;" bgcolor="lightyellow">
The reactor always uses the same thread.
</td>
<td style="padding: 5px;" bgcolor="lightyellow">
Disbursed when there are no more messages to be processed.
</td>
</tr>

<tr>
<td style="padding: 5px;" bgcolor="lightyellow">
<a href="../../api/core/org/agilewiki/jactor2/core/reactors/SwingBoundReactor.html">SwingBoundReactor</a>
</td>
<td style="padding: 5px;" bgcolor="lightyellow">
True
</td>
<td style="padding: 5px;" bgcolor="lightyellow">
The reactor uses the Swing UI thread.
</td>
<td style="padding: 5px;" bgcolor="lightyellow">
Disbursed when there are no more messages to be processed.
</td>
</tr>

</table>
<h2>
IsolationReactor
</h2>
<p>
The use of an IsolationReactor is sometimes essential to properly process an asynchronous operation.
This happens when an operation accesses the state of the blade,
sends an operation to another reactor,
and then updates the state of the blade based on its old value.
This is illustrated by the <a href="java7/Isolation.java">Isolation</a> program:
</p>
<pre>
import org.agilewiki.jactor2.core.blades.BladeBase;
import org.agilewiki.jactor2.core.impl.Delay;
import org.agilewiki.jactor2.core.blades.NonBlockingBladeBase;
import org.agilewiki.jactor2.core.impl.Plant;
import org.agilewiki.jactor2.core.requests.AOp;
import org.agilewiki.jactor2.core.requests.AsyncResponseProcessor;
import org.agilewiki.jactor2.core.reactors.IsolationReactor;
import org.agilewiki.jactor2.core.reactors.NonBlockingReactor;
import org.agilewiki.jactor2.core.reactors.Reactor;
import org.agilewiki.jactor2.core.requests.impl.AsyncRequestImpl;

public class Isolation extends NonBlockingBladeBase {
    
    public static void main(final String[] _args) throws Exception {
        new Plant();
        try {
            Isolation isolation = new Isolation();

            System.out.println("\nBump with NonBlockingReactor\n");
            Isolate isolate = new Isolate(new NonBlockingReactor());
            isolation.runAOp(isolate).call();
            
            System.out.println("\nBump with IsolationReactor\n");
            isolate = new Isolate(new IsolationReactor());
            isolation.runAOp(isolate).call();
        } finally {
            Plant.close();
        }
    }
	
	public Isolation() throws Exception {
	}
    
    AOp&lt;Void&gt; runAOp(final Isolate _isolate) {
        return new AOp&lt;Void&gt;("run", getReactor()) {
            protected void processAsyncOperation(final AsyncRequestImpl _asyncRequestImpl, 
					final AsyncResponseProcessor&lt;Void&gt; _asyncResponseProcessor) throws Exception {
                _asyncRequestImpl.send(_isolate.bumpAOp(), null);
                _asyncRequestImpl.send(_isolate.bumpAOp(), null);
                _asyncRequestImpl.send(_isolate.bumpAOp(), _asyncResponseProcessor);
            }
        };
    }
}
 
class Isolate extends BladeBase { 
    int state;
    
    Isolate(final Reactor _reactor) {
        _initialize(_reactor);
    }
    
    AOp&lt;Void&gt; bumpAOp() {
        return new AOp&lt;Void&gt;("bump", getReactor()) {
            protected void processAsyncOperation(final AsyncRequestImpl _asyncRequestImpl, 
					final AsyncResponseProcessor&lt;Void&gt; _asyncResponseProcessor) throws Exception {
                int oldState = state;
                final int newState = state + 1;
                System.out.println("was " + oldState + ", now " + newState); 
                Delay delay = new Delay();
                _asyncRequestImpl.send(delay.sleepSOp(1), new AsyncResponseProcessor&lt;Void&gt;() {
                    public void processAsyncResponse(Void response) throws Exception {
                        state = newState; //belated update
                        _asyncResponseProcessor.processAsyncResponse(null);
                    }
                });
            }
        };
    }
}

Output:

Bump with NonBlockingReactor

was 0, now 1
was 0, now 1
was 0, now 1

Bump with IsolationReactor

was 0, now 1
was 1, now 2
was 2, now 3
</pre>
</body>
</html>
